<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast Nearest Neighbour Search (Rcpp Wrapper of Arya and Mounts libANN') • RANN2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fast Nearest Neighbour Search (Rcpp Wrapper of Arya and Mounts libANN')">
<meta property="og:description" content="Finds the k nearest neighbours for every point in a given dataset
    in O(N log N) time using Arya and Mounts ANN library (v1.1.3). This wrapper
    uses Rcpp to simplify access compared with the original RANN' package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">RANN2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/nn2-timings.html">nn2-timings</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jefferis/RANN2/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rann2" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rann2" class="anchor"></a>RANN2</h1></div>
<!-- badges: start -->

<p>This package is an updated version of the <a href="https://cran.r-project.org/package=RANN">RANN</a> package, making use of the Rcpp package. For basic use, there is little difference with original RANN package although there are some small (typically 5-10%) speedups for certain query/target size combinations. <strong>RANN2</strong> also includes experimental functionality via <code>WANN</code> objects to:</p>
<ul>
<li>keep ANN points in memory to avoid repeated copying</li>
<li>keep the ANN k-d tree in memory to avoid repeated building</li>
<li>separate building the k-d tree from allocating the points</li>
<li>permit very fast self queries</li>
<li>permit queries of the points from one ANN tree against a second tree</li>
</ul>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Currently there isn’t a released version on <a href="https://cran.r-project.org/">CRAN</a>, although we are considering a submission when the package develops sufficiently distinct functionality from the original RANN package.</p>
<div id="development-version" class="section level3">
<h3 class="hasAnchor">
<a href="#development-version" class="anchor"></a>Development version</h3>
<p>You can use the <strong>devtools</strong> package to install the development version:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"devtools"</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"jefferis/RANN2"</span>)</pre></div>
<p>Note: Windows users need <a href="http://www.murdoch-sutherland.com/Rtools/">Rtools</a> and <a href="https://cran.r-project.org/package=devtools">devtools</a> to install this way.</p>
</div>
</div>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Use</h2>
<div id="basic-use" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-use" class="anchor"></a>Basic use</h3>
<p>The expectation is that for 90% of users the <code>nn2</code> function should be the only way that the library is used. This takes a target matrix of R points, copies them into an array used by ANN and builds a k-d tree. It then iterates over the query points, searching the tree one at a time.</p>
</div>
<div id="advanced-use" class="section level3">
<h3 class="hasAnchor">
<a href="#advanced-use" class="anchor"></a>Advanced use</h3>
<p><strong>RANN2</strong> adds <code>WANN</code> objects, which allow fine control of when the k-d tree is built and removed.</p>
<pre><code><a href="https://rdrr.io/r/utils/data.html">data(kcpoints)
w1=WANN(kcpoints[[1]])
library(microbenchmark)
microbenchmark(w1sq&lt;-w1$selfQuery(k=1,eps=0))
microbenchmark(nn2(kcpoints[[1]],k=1))
w2=WANN(kcpoints[[2]])
# NB must pass the Cpp object not the reference class object
w1$queryWANN(w2$.CppObject)</a></code></pre>
<p>WANN objects will primarily be useful if you make repeated queries. You can also delay building the k-d tree:</p>
<pre><code>w1=WANN(kcpoints[[1]])
w1$querySelf(k=1,eps=0)
w1$build_tree()
w1$delete_tree()</code></pre>
<p>if only a fraction of the objects will need to be searched; the tree will automatically be built when it is queried. You can also explicitly control when the tree is built or deleted (for memory management). The tree is wrapped in an R reference class (R5) object which imposes a significant performance penalty for building small trees (&lt; ~ 1000 points).</p>
</div>
<div id="changing-ann-data-types" class="section level3">
<h3 class="hasAnchor">
<a href="#changing-ann-data-types" class="anchor"></a>Changing ANN data types</h3>
<p>By default ANN uses <code>double</code>s for both points and returned distances. You can save space by changing this if you want. To do to this you must recompile after setting either <code>ANN_COORD_TYPE</code> or <code>ANN_DIST_TYPE</code> in <code>src/MAKEVARS</code> or <code>MAKEVARS.win</code> as appropriate. e.g. </p>
<pre><code>PKG_CPPFLAGS=-I. -IANN -DRANN -DANN_COORD_TYPE=float</code></pre>
<p>would switch to the use of floats for the main ANN coordinate type. Note however that the k-d tree itself appears to occupy ~ 2x the space of the underlying double coordinates.</p>
</div>
<div id="linking-and-using-ann-library" class="section level3">
<h3 class="hasAnchor">
<a href="#linking-and-using-ann-library" class="anchor"></a>Linking and using ANN library</h3>
<p>This package compiles a static library for ANN and provides the headers for it. Developers can directly include them in their C++ code / Rcpp based package.</p>
<div id="instructions" class="section level4">
<h4 class="hasAnchor">
<a href="#instructions" class="anchor"></a>Instructions</h4>
<p><code>DESCRIPTION</code> file:</p>
<pre><code>    LinkingTo: RANN2</code></pre>
<p><code>src/Makevars</code> file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a>    <span class="va">PKG_IMPORT=</span>RANN2</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="va">PKG_HOME=</span><span class="kw">`</span><span class="va">${R_HOME}</span><span class="ex">/bin/Rscript</span> -e <span class="st">'cat(system.file(package=\"$(PKG_IMPORT)\"))'</span><span class="kw">`</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="va">PKG_LIBS=</span>-L<span class="va">$(</span><span class="ex">PKG_HOME</span><span class="va">)</span>/lib <span class="ex">-l</span><span class="va">$(</span><span class="ex">PKG_IMPORT</span><span class="va">)</span></span></code></pre></div>
<p><code>src/Makevars.win</code> file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>    <span class="va">PKG_IMPORT=</span>RANN2</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="va">PKG_HOME=</span><span class="kw">`</span><span class="va">${R_HOME}</span><span class="ex">/bin/Rscript</span> -e <span class="st">'cat(system.file(package=\"$(PKG_IMPORT)\"))'</span><span class="kw">`</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="va">PKG_LIBS+=</span>-L<span class="va">$(</span><span class="ex">PKG_HOME</span><span class="va">)</span>/lib <span class="ex">-l</span><span class="va">$(</span><span class="ex">PKG_IMPORT</span><span class="va">)</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="va">PKG_CPPFLAGS+=</span>-DDLL_EXPORTS</span></code></pre></div>
<p>Your <code>C++</code> file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1"></a>    <span class="pp">#include </span><span class="im">&lt;ANN.h&gt;</span></span></code></pre></div>
<p>For usage example: <a href="https://github.com/jefferis/RANN2/blob/master/src/nn.cpp">src/nn.cpp</a></p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/jefferis/RANN2/">https://​github.com/​jefferis/​RANN2/​</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=3)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Gregory Jefferis <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0587-9355" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Sunil Arya <br><small class="roles"> Author, copyright holder </small> <a href="https://orcid.org/0000-0003-0939-4192" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>David Mount <br><small class="roles"> Author, copyright holder </small> <a href="https://orcid.org/0000-0002-3290-8932" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://jefferis.github.io/RANN2/"><img src="https://img.shields.io/badge/docs-100%25-brightgreen.svg" alt="Docs"></a></li>
<li><a href="https://travis-ci.org/jefferis/RANN2"><img src="https://travis-ci.org/jefferis/RANN2.svg" alt="Build Status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#maturing"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="lifecycle"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Gregory Jefferis, Sunil Arya, David Mount.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
